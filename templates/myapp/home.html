{% extends 'base.html' %}
{% load static %}

{% block content %}
<style>
  * {
    box-sizing: border-box;
  }

  body, html {
    margin: 0;

    overflow-x: hidden;
    background: #000;
    color: #fff;
    font-family: 'Segoe UI', Roboto, sans-serif;
  }

  .container {
    width: 100%;
    max-width: 600px;
    margin: 25px auto;
    padding: 24px 20px;
    background: #111;
    border-radius: 24px;
    box-shadow: 0 0 15px rgba(255, 255, 255, 0.08);
  }

  .search-bar {
    margin-bottom: 20px;
  }

  .search-bar input[type="search"] {
    width: 100%;
    padding: 12px 16px;
    font-size: 1rem;
    border: none;
    border-radius: 24px;
    background: #222;
    color: #eee;
    text-align: center;
    outline: none;
    box-shadow: 0 0 6px rgba(255, 255, 255, 0.05);
    transition: background 0.3s ease;
  }

  .search-bar input[type="search"]:focus {
    background: #333;
    border: 1px solid #555;
  }

  .conversation-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .conversation-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 14px 12px;
    background: #1a1a1a;
    margin-bottom: 12px;
    border-radius: 18px;
    cursor: pointer;
    transition: background 0.3s ease;
  }

  .conversation-item:hover {
    background: #2a2a2a;
  }

  .conversation-photo {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid #333;
    flex-shrink: 0;
  }

  .conversation-details {
    flex: 1;
    min-width: 0;
  }

  .conversation-name {
    font-weight: 600;
    font-size: 1.05rem;
    color: #fff;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .conversation-last-message {
    font-size: 0.9rem;
    color: #aaa;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    margin-top: 2px;
  }

  .conversation-time {
    font-size: 0.75rem;
    color: #777;
    margin-left: 8px;
    white-space: nowrap;
    flex-shrink: 0;
  }

  @media (max-width: 600px) {
    .container {
      margin: 10px 10px;
      padding: 20px 16px;
      border-radius: 0;
      box-shadow: none;
    }

    .conversation-photo {
      width: 42px;
      height: 42px;
    }

    .conversation-name {
      font-size: 1rem;
    }

    .conversation-last-message {
      font-size: 0.85rem;
    }

    .conversation-time {
      font-size: 0.7rem;
    }
  }
</style>

<div class="container">
  <form method="get" class="search-bar" role="search" aria-label="Search conversations">
    <input type="search" name="q" value="{{ query }}" placeholder="Search your Besties" autocomplete="off" />
  </form>

  {% if conversations %}
    <ul class="conversation-list" role="list">
      {% for convo in conversations %}
        <li class="conversation-item" role="listitem" tabindex="0" onclick="location.href='{% url 'chat' convo.username %}'" onkeypress="if(event.key === 'Enter') location.href='{% url 'chat' convo.username %}'">
          <img class="conversation-photo" src="{{ convo.photo_url }}" alt="Photo of {{ convo.full_name|default:convo.username }}" />
          <div class="conversation-details">
            <div class="conversation-name">{{ convo.full_name|default:convo.username }}</div>
            <div class="conversation-last-message">{{ convo.last_message|default:"No messages yet" }}</div>
          </div>
          {% if convo.last_message_time %}
            <time class="conversation-time" datetime="{{ convo.last_message_time|date:'c' }}" aria-label="Last message at {{ convo.last_message_time|date:'d M Y, H:i' }}">
              {{ convo.last_message_time|date:"d M Y, H:i" }}
            </time>
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p style="text-align:center; color:#999; margin-top:2rem;">No bestie conversations found.</p>
  {% endif %}
</div>
{% endblock %}
